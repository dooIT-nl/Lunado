<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="stock_picking_view_template" model="ir.ui.view">
        <field name="name">stock.picking.view.template</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_form" />
        <field name="arch" type="xml">
            <xpath expr="." position="inside">
                <link rel="stylesheet" href="/dmmodule/static/src/css/deliverymatch.css"/>
            </xpath> 

            <field name="partner_id" position="after">
                <field name="dm_warehouse_number"/>
            </field>

            <notebook position="inside">
                <page class="dm-page" string="DeliveryMatch | Shipping options" name="deliverymatch_delivery_page">
                    <group string="Execution" class="dm-group" attrs="{'invisible': [('dm_shipment_booked', '=', True)]}"/>
                        <div class="d-flex w-100 align-items-center" attrs="{'invisible': [('dm_shipment_booked', '=', True)]}">

                            <button
                                class="dm-orange dm-btn" 
                                name="show_shipping_options" 
                                string="Request shipping options"
                                type="object"
                            />

                            <button
                                class="dm-purple dm-btn"
                                name="set_carrier_from_sale_order"
                                string="Inherit shipping option"
                                type="object"
                                attrs="{'invisible': ['|', ('get_carrier_from_sales_order', '=', False), ('dm_is_inbound', '=', True)] }"

                            />


                            <div attrs="{'invisible': [('delivery_option_selected', '=', False)]}">
                                <button 
                                    class="dm-green dm-btn"
                                    name="book_delivery"
                                    string="Book order to carrier" 
                                    type="object" 
                                    attrs="{'invisible': [('dm_is_external_warehouse', '=', True)]}"
                                />
                                
                                <button class="dm-blue dm-btn" 
                                    name="book_delivery_to_hub"
                                    string="Send order to warehouse"
                                    type="object"
                                    attrs="{'invisible': [('dm_is_external_warehouse', '=', False)]}"
                                />
                            </div>

                            <field name="dm_label_amount" placeholder="Select label amount" class="ms-auto" attrs="{'invisible': [('show_packages', '=', True)]}"/>
                        </div>


                    <group string="Calculated Packages" attrs="{'invisible': ['|', ('dm_shipment_booked', '=', True), ('show_packages', '=', False)]}">
                        <field name="packages" string="" context="{'tree_view_ref' : 'dmmodule.package_table_tree'}" />
                    </group>

                    <group string="Labels" attrs="{'invisible': ['|', ('dm_shipment_booked', '=', False), ('show_packages', '=', False)]}">
                        <field name="labels" string="" readonly="1" context="{'tree_view_ref' : 'dmmodule.label_table_tree'}" />
                    </group>


                    <group string="Selected shipping option">
                        <field name="dm_carrier_name" readonly="True" />
                        <field name="dm_service_level_name" readonly="True" />
                        <field name="dm_service_level_description" readonly="True" />
                        <field name="dm_pickup_date" readonly="True" />
                        <field name="dm_delivery_date" readonly="True" />
                        <field name="dm_sell_price" readonly="True" />
                        <field name="dm_buy_price" readonly="True" />
                        <field name="dm_shipment_url" widget="url" readonly="True" />
                        <field name="dm_is_external_warehouse" invisible="True" />
                        <field name="dm_shipment_booked" invisible="1" />
                        <field name="delivery_option_selected" invisible="True" />
                        <field name="show_packages" invisible="1" />
                        <field name="get_carrier_from_sales_order" invisible="1"/>
                        <field name="delivery_order_number" string="DeliveryMatch order number" readonly="1"/>
                        <field name="dm_is_inbound" readonly="1" invisible="1"/>
                        <field name="show_product_hscode" readonly="1" invisible="1"/>
                        <field name="dm_config_id" readonly="1" invisible="0"/>
                    </group>


                    <group string="Tracking &amp; Shipping labels" attrs="{'invisible': [('shipment_label_attachment', '=', True)]}">
                        <field name="tracking_urls" readonly="True" />
                        <field name="shipment_label_attachment" widget="pdf_viewer" readonly="True" attrs="{'invisible': [('shipment_label_attachment', '=', True)]}"/>
                    </group>

                </page>
            </notebook>

        </field>
    </record>
</odoo>